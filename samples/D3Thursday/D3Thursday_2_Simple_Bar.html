<!DOCTYPE html>
<!--
Copyright 2018 SAS Institute Inc.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
<html>
<head>
	<!-- Import D3.js -->
	<script type="text/javascript" src="https://d3js.org/d3.v5.min.js"></script>
</head>
<body>
<style type="text/css">
	html, body, svg {
		overflow: hidden;
		margin: 0px;
		width: 100%;
		height: 100%;
	}

	.data-bar {
		fill: steelblue;
	}

	.data-bar:hover {
		fill: lightsteelblue;
	}
</style>

<script>
	"use strict";

	document.addEventListener("DOMContentLoaded", function(e) {
		/*************************************************** Declare global variables ***************************************************/
		// Data variables
		var SVG_ID = "simple-bar";											// ID of SVG element
		var DATA = [["Apple", 50],
					["Banana", 35],
					["Mango", 40],
					["Orange", 20]
		];																	// Hard coded data in same format SAS VA sends data

		// Static dimension variables
		var MARGIN = {top: 20, right: 20, bottom: 40, left: 40};			// Margin on interior edge of SVG

		// Dynamic dimension variables
		var WIDTH = window.innerWidth;										// Width of SVG element
		var HEIGHT = window.innerHeight;									// Height of SVG element
		var DRAWABLE_WIDTH = WIDTH - MARGIN.right - MARGIN.left;			// Drawable width of SVG
		var DRAWABLE_HEIGHT = HEIGHT - MARGIN.bottom - MARGIN.top;			// Drawable height of SVG

		// Selection and d3 variables
		var SVG;															// SVG selection
		var G_X_AXIS;														// X Axis Group selection
		var G_Y_AXIS;														// Y Axis Group selection
		var G_CHART_AREA;													// Chart Area Group selection
		var X_SCALE;														// X Scale
		var Y_SCALE;														// Y Scale
		var X_AXIS;															// X Axis selection
		var Y_AXIS;															// Y Axis selection
		var DATA_BARS;														// Data Bars data-join


		/**************************************************** Create Static Elements ****************************************************/
		// Append svg and save reference
		d3.select("body").selectAll("#" + SVG_ID).data([DATA]).enter().append("svg")
			.attr("id", SVG_ID);

		SVG = d3.select("#" + SVG_ID)
			.attr("width", WIDTH)
			.attr("height", HEIGHT);

		// Append x axis group and save reference
		SVG.selectAll(".g-x-axis").data([DATA]).enter().append("g")
			.classed("g-x-axis", true);

		G_X_AXIS = SVG.select(".g-x-axis")
			.attr("transform", "translate(" + (MARGIN.left) + "," + (HEIGHT-MARGIN.bottom) + ")");

		// Append y axis group and save reference
		SVG.selectAll(".g-y-axis").data([DATA]).enter().append("g")
			.classed("g-y-axis", true)
			.attr("transform", "translate(" + (MARGIN.left) + "," + (MARGIN.top) + ")");

		G_Y_AXIS = SVG.select(".g-y-axis");

		// Append chart area group and save reference
		SVG.selectAll(".g-chart-area").data([DATA]).enter().append("g")
			.classed("g-chart-area", true)
			.attr("transform", "translate(" + (MARGIN.left) + "," + (MARGIN.top) + ")");

		G_CHART_AREA = SVG.select(".g-chart-area");


		/************************************************ Create Data Dependent Elements ************************************************/
		// Create x scale
		X_SCALE = d3.scaleBand()
			.rangeRound([0, DRAWABLE_WIDTH])
			.padding(0.1)
			.domain(DATA.map(function(d) { return d[0]; }));

		// Create y scale
		Y_SCALE = d3.scaleLinear()
			.rangeRound([DRAWABLE_HEIGHT, 0])
			.domain([0, d3.max(DATA, function(d) { return d[1]; })]);

		// Create x axis
		X_AXIS = G_X_AXIS.selectAll(".x-axis").data([DATA]);

		X_AXIS.enter().append("g")
			.classed("x-axis", true)
			.call(d3.axisBottom(X_SCALE));

		// Create y axis
		Y_AXIS = G_Y_AXIS.selectAll(".y-axis").data([DATA]);

		Y_AXIS.enter().append("g")
			.classed("y-axis", true)
			.call(d3.axisLeft(Y_SCALE));

		// Create bars for each country + year
		DATA_BARS = G_CHART_AREA.selectAll(".data-bar").data(DATA);

		DATA_BARS.enter().append("rect")
			.classed("data-bar", true)
			.attr("x", function(d) { return X_SCALE(d[0]); })
			.attr("y", function(d) { return Y_SCALE(d[1]); })
			.attr("width", function(d) { return X_SCALE.bandwidth(); })
			.attr("height", function(d) { return DRAWABLE_HEIGHT - Y_SCALE(d[1]); });
	});
</script>
</body>
</html>
